<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fileformat>
<fileformat>

	<xi:include href="../ovl_base/ovl_base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

	<enum name="DdsType" storage="ubyte">
		maps the OVL's dds type to name of compression format
		<option value="35" name="DXGI_FORMAT_R8G8B8A8_UNORM"></option>
		<option value="37" name="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB">gharial_male.pclut.dds, or DXGI_FORMAT_D24_UNORM_S8_UINT, DXGI_FORMAT_R8G8B8A8_UNORM</option>
		<option value="38" name="DXGI_FORMAT_D32_FLOAT_S8X24_UINT">atmospherics_stars_data.dds</option>
		<option value="43" name="DXGI_FORMAT_R16G16_FLOAT"></option>
		<!-- <option value="59" name="?"></option> -->

		<option value="78" name="DXGI_FORMAT_BC1_UNORM"></option>
		<option value="79" name="DXGI_FORMAT_BC1_UNORM_SRGB"></option>
		<option value="80" name="DXGI_FORMAT_BC2_UNORM"></option>
		<option value="81" name="DXGI_FORMAT_BC2_UNORM_SRGB"></option>
		<option value="82" name="DXGI_FORMAT_BC3_UNORM">PZ wolf baldnessscars texture</option>
		<option value="83" name="DXGI_FORMAT_BC3_UNORM_SRGB"></option>
		<option value="84" name="DXGI_FORMAT_BC4_UNORM"></option>
		<option value="85" name="DXGI_FORMAT_BC4_SNORM"></option>
		<option value="86" name="DXGI_FORMAT_BC5_UNORM"></option>
		<option value="87" name="DXGI_FORMAT_BC5_SNORM"></option>
		<option value="88" name="DXGI_FORMAT_BC6H_UF16">ptero aviary</option>
		<option value="89" name="DXGI_FORMAT_BC6H_SF16"></option>
		<option value="90" name="DXGI_FORMAT_BC7_UNORM"></option>
		<option value="91" name="DXGI_FORMAT_BC7_UNORM_SRGB">PZ titan beetle</option>
    </enum>

    <enum name="DdsTypeCoaster" storage="ubyte">
		maps the OVL's dds type to name of compression format
		<option value="74" name="DXGI_FORMAT_D24_UNORM_S8_UINT">ZTUAC ele heights textures</option>
		<option value="97" name="DXGI_FORMAT_BC1_UNORM"></option>
		<option value="98" name="DXGI_FORMAT_BC1_UNORM_SRGB"></option>
		<option value="99" name="DXGI_FORMAT_BC2_UNORM"></option>
		<option value="100" name="DXGI_FORMAT_BC2_UNORM_SRGB"></option>
		<option value="101" name="DXGI_FORMAT_BC3_UNORM"></option>
		<option value="102" name="DXGI_FORMAT_BC3_UNORM_SRGB"></option>
		<option value="103" name="DXGI_FORMAT_BC4_UNORM"></option>
		<option value="104" name="DXGI_FORMAT_BC4_SNORM"></option>
		<option value="105" name="DXGI_FORMAT_BC5_UNORM"></option>
		<option value="106" name="DXGI_FORMAT_BC5_SNORM"></option>

		<option value="121" name="DXGI_FORMAT_BC4_UNORM_B"></option>
		<option value="126" name="DXGI_FORMAT_BC7_UNORM"></option>
		<option value="127" name="DXGI_FORMAT_BC7_UNORM_SRGB"></option>

		<option value="250" name="DXGI_FORMAT_ALL"></option>
    </enum>

	<compound name="Header3Data0" >
		Data struct for headers of type 3, read by data 0 of 3,7 frag.
		16 bytes
		<add name="zeros" type="uint64" >32 bytes, all 0</add>
		<add name="compression type" type="DdsType" vercond="!#OLD#">flag, not direct index into DDS enum</add>
		<add name="compression type" type="DdsType_Coaster" vercond="#OLD#">flag, not direct index into DDS enum</add>
		<add name="one 0" type="ubyte">0 or 1</add>
		<add name="stream_count" type="ubyte">amount of files combined in this texture, usually 1 or 2, 3 for JWE2 rex</add>
		<add name="stream_count repeat" type="ubyte">usually as above</add>
		<add name="pad" type="uint">0</add>
    </compound>

	<compound name="Header3Data0Pc" >
		todo remove
		Data struct for headers of type 3, read by data 0 of 3,7 frag.
		16 bytes
		<add name="zeros" type="uint64" >8 bytes, all 0</add>
		<add name="compression type" type="DdsType_Coaster" >flag, not direct index into DDS enum</add>
		<add name="one 0" type="ubyte">0 or 1</add>
		<add name="one 1" type="ubyte">1 or 2</add>
		<add name="one 2" type="ubyte">1 or 2</add>
		<add name="pad" type="uint">0, might be first 4 bytes of tex buffer for ztuac</add>
    </compound>

	<compound name="Header3Data1" >
		Part of a fragment, repeated for count of texture LODs / buffers.
		Data struct for headers of type 3
		24 bytes per texture buffer
		<add name="data size previous" type="uint64">Size of previous tex buffer</add>
		<add name="data size" type="uint64">Size of this tex buffer</add>
		<add name="unkn" type="uint64">is also related to data size</add>
    </compound>

	<compound name="Header3Data1Pc" >
		Data struct for headers of type 7
		<add name="width" type="ushort"></add>
		<add name="height" type="ushort" > </add>
		<add name="array size" type="ushort">may be depth</add>
		<add name="num mips" type="ushort">num_mips</add>
    </compound>

	<compound name="Header3Data1ZTUAC" >
		Data struct for headers of type 7
		<add name="lods" type="Header3Data1ZTUACEntry" arr1="#ARG#"></add>
		<add name="data size" type="ushort">?not sure if this isn't just junk data</add>
        is something remains, it seems to be padding!
    </compound>

	<compound name="Header3Data1ZTUACEntry" >
		Data struct for headers of type 7
		<add name="width" type="ushort">x</add>
		<add name="height" type="ushort" >y</add>
		<add name="num mips" type="ushort">num_mips</add>
    </compound>

	<compound name="Header7Data1" >
		Data struct for headers of type 7
		<add name="zero" type="uint64">zero</add>
		<add name="data size" type="uint" >total dds buffer size</add>
		<add name="width" type="uint">x size in pixels</add>
		<add name="height" type="uint" >y size in pixels</add>
		<add name="depth" type="uint" >aka tile_width; may be depth</add>
		<add name="array_size" type="uint">aka tile_height; may be array_size</add>
		<add name="num mips" type="uint">amount of mip map levels</add>
		<add name="unk_pz" type="uint64" since="20">only found in PZ and JWE2</add>
		<add name="mip maps" type="Mipmap" arr1="num mips">info about mip levels</add>
    </compound>

	<compound name="Mipmap" >
		Data struct for one mipmap, part of a data 1 struct in headers of type 7
		<add name="offset" type="uint">starting offset into the texture buffer for this mip level</add>
		<add name="size" type="uint" >bytes</add>
		<add name="size repeat" type="uint">bytes</add>
		<add name="unknown0C" type="uint" >decreases quadratically</add>
		<add name="unkn3" type="uint">may be size of actual data - usually, repeat of size, not for the last lods</add>
    </compound>

    <compound name="TexHeader" >
        Sized str entry of 8 or 16 bytes
        <add name="zero 0" type="uint64" >?</add>
        <add name="zero 1" type="uint64" vercond="!#OLD#">?</add>
    </compound>

    <compound name="Frag00" >
        8 bytes, empty?
        <add name="zero 0" type="uint64" >?</add>
    </compound>

    <compound name="TexInfoHeader" inherit="GenericHeader">
<!--		<add name="num buffers" type="uint" >total dds buffer size</add>-->
		<add name="tex info" type="TexHeader"/>
		<add name="frag_00" type="Frag00" vercond="!#OLD#"/>
		<add name="frag_10" type="Header3Data0"/>
		<add name="frag_01" type="Header3Data1" arr1="frag_10 \ stream_count"/>
<!--		<add name="frag_01" type="Header3Data1" arr1="num buffers"/>-->
		<add name="frag_11" type="Header7Data1"/>
    </compound>
</fileformat>

