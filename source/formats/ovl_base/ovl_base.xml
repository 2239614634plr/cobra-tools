<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE niftoolsxml>
<niftoolsxml version="0.7.1.0">

    <token name="verexpr" attrs="vercond">
        Commonly used version expressions.
        <verexpr token="#DLA#" string="(#VER# #EQ# 15)">Disneyland Adventure</verexpr>
        <verexpr token="#ZTUAC#" string="(#VER# #EQ# 17)">ZTUAC</verexpr>
		<verexpr token="#PC#" string="(#VER# #EQ# 18)">PC</verexpr>
        <verexpr token="#PZ#" string="(((#USER# #EQ# 8340) #OR# (#USER# #EQ# 8724)) #AND# (#VER# #GTE# 19))">PZ</verexpr>
        <verexpr token="#PZ16#" string="(#VER# #EQ# 20)">PZ</verexpr>
        <verexpr token="#JWE#" string="(((#USER# #EQ# 24724) #OR# (#USER# #EQ# 25108)) #AND# (#VER# #EQ# 19))">JWE, 25108 is JWE on switch</verexpr>
        <verexpr token="#JWE2#" string="((#USER# #EQ# 25108) #AND# (#VER# #EQ# 20))">JWE2</verexpr>
    </token>

	<token name="global" attrs="vercond access">
        Global Tokens.
        NOTE: These must be listed after the above tokens so that they replace last. For example, `verexpr` uses these tokens.
        <global token="#USER#" string="user_version" />
        <global token="#VER#" string="version" />
        <global token="#FLAG#" string="version_flag" />
    </token>

	<xi:include href="../base/base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

	<verattr name="version" access="#VER#" index="0" />
	<verattr name="user_version" access="#USER#" index="1" type="VersionInfo"/>
	<verattr name="version_flag" access="#FLAG#" index="2" />

    <version id="DLA" version="15">Disneyland Adventure</version>
    <version id="ZTUAC" version="17">Zoo Tycoon Ultimate Animal Collection</version>
    <version id="PC" version="18">Planet Coaster</version>
    <version id="PZ" version="19" user_version="8340 8724">Planet Zoo pre-1.6</version>
    <version id="PZ16" version="20" user_version="8340 8724">Planet Zoo 1.6+</version>
    <version id="JWE" version="19" user_version="24724 25108">Jurassic World Evolution</version>
    <version id="JWE2" version="20" user_version="25108">Jurassic World Evolution 2</version>

    <bitfield name="VersionInfo" storage="uint">
        Determines the format of the OVL file.
        n.b. pos counts from the end!
        <member width="1" pos="2" name="unk1" type="bool"/>
        <member width="1" pos="4" name="unk2" type="bool"/>
        <member width="1" pos="7" name="use zlib" type="bool"/>
        <member width="1" pos="9" name="use oodle" type="bool"/>
        <member width="1" pos="13" name="unk3" type="bool"/>
        <member width="1" pos="14" name="is jwe" type="bool"/>
    </bitfield>

    <!-- Extra basic types -->

    <basic name="bool" count="1">
        An unsigned 8-bit integer.
    </basic>

    <basic name="ZString">
        A string of given length.
    </basic>

	<!-- Structs for the OVL file -->

    <compound name="ZStringBuffer" count="0" >
        Holds a buffer of zero-terminated strings
    </compound>

    <compound name="FixedString" count="0" >
        Holds a string of a fixed size, given as an argument.
    </compound>

	<compound name="PadAlign">
		Grabs 00 bytes only
	</compound>

    <compound name="GenericHeader">
        Found at the beginning of every OVL file
        <add name="magic" type="FixedString" arg="4">'FGM ' for fgm, 'FRES' for ovl, 'MANI' for manis, 'MS2 ' for ms2, 'VOXE' for voxelskirt</add>
        <add name="version flag" type="byte" >if 0x08 then 64bit, 0x01 for JWE, PZ, 0x08 for PC, 0x48 for JWE Switch, may be platform</add>
        <add name="version" type="byte" >0x12 = PC, 0x13 = JWE, PZ</add>
        <add name="Bitswap" type="byte" >endianness?, usually zero</add>
        <add name="Seventh Byte" type="byte" default="1" >always = 1</add>
        <add name="user version" type="VersionInfo" >determines compression format (none, zlib or oodle) and apparently type of data (additional fields)</add>
    </compound>

</niftoolsxml>
