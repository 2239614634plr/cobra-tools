<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE niftoolsxml>
<niftoolsxml version="0.7.1.0">

	<xi:include href="../ovl_base/ovl_base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

    <compound name="MotiongraphHeader" inherit="MemStruct">
        <add name="ptr_0" type="Pointer" template="MotiongraphRootFrag"/>
        <add name="ptr_1" type="Pointer" template="MGTwo"/>
        <add name="ptr_2" type="Pointer" template="MGTwo"/>
        <add name="ptr_3" type="Pointer" template="ThirdFrag"/>

        <add name="count_0" type="uint"/>
        <add name="count_1" type="uint"/>

        <add name="ptr_4" type="Pointer"/>
        <add name="lua results" type="Pointer" template="ZString"/>
        <add name="first_non_transition_state" type="Pointer" template="MRFMember2"/>
        <add name="empty str" type="Pointer" template="ZString"/>
    </compound>

    <compound name="MotiongraphRootFrag" inherit="MemStruct">
        64 bytes
        <add name="num_activities" type="uint64"/>
        <add name="activities" type="Pointer" template="Activities" arg="num_activities"/>

        <add name="count_1" type="uint64"/>
        <add name="ptr_1" type="Pointer" template="MRFArray1" arg="count_1"/>

        <add name="count_2" type="uint64"/>
        <add name="ptr_2" type="Pointer" template="MRFArray2" arg="count_2"/>

        <add name="num_xmls" type="uint64"/>
        <add name="ptr_xmls" type="Pointer" template="XMLArray" arg="num_xmls"/>
    </compound>

    <compound name="Activities" inherit="MemStruct" >
        <add name="states" type="ActivityEntry" arr1="#ARG#" />
    </compound>

    <compound name="ActivityEntry" inherit="MemStruct">
        8 bytes
        <add name="value" type="Pointer" template="Activity"/>
    </compound>

    <compound name="Activity" inherit="MemStruct">
        48 bytes
        <add name="data_type" type="Pointer" template="ZString"/>
        # can point to data of changing size
        template has to be defined according to data type ie 'AnimationActivity' + 'Data'
        <add name="ptr" type="Pointer"/>
        <add name="count_2" type="uint64"/>
        <add name="count_3" type="uint64"/>
        <add name="minus one" type="int64"/>
        <add name="name b" type="Pointer" template="ZString"/>
    </compound>

    <compound name="MRFArray1" inherit="MemStruct" >
        <add name="states" type="MRFEntry1" arr1="#ARG#" />
    </compound>

    <compound name="MRFEntry1" inherit="MemStruct">
        8 bytes
        <add name="value" type="Pointer" template="MRFMember1"/>
    </compound>

    <compound name="MRFMember1" inherit="MemStruct">
        72 bytes, is like ThirdFrag, but different templates
        <add name="LuaMethod" type="Pointer" template="ZString"/>

        <add name="count_0" type="uint64"/>
        <add name="count_1" type="uint64"/>

        variable size, maybe related to counts
        <add name="ptr_1" type="Pointer" />

        <add name="count_2" type="uint64"/>
        <add name="count_3" type="uint64"/>

        variable size, maybe related to counts
        <add name="ptr_2" type="Pointer" />

        <add name="count_4" type="uint64"/>
        <add name="id" type="Pointer" template="ZString"/>
    </compound>

    <compound name="MRFArray2" inherit="MemStruct" >
        <add name="states" type="MRFEntry2" arr1="#ARG#" />
    </compound>

    <compound name="MRFEntry2" inherit="MemStruct">
        8 bytes
        <add name="value" type="Pointer" template="MRFMember2" />
    </compound>

    <compound name="MRFMember2" inherit="MemStruct">
        72 bytes
        only used if transition is in 'id'
        <add name="transition" type="Pointer" template="Transition"/>

        <add name="count_0" type="uint64"/>
        <add name="count_1" type="uint64"/>

        <add name="count_2" type="uint64" />

        <add name="count_3" type="uint64"/>
        <add name="count_4" type="uint64"/>

        <add name="count_5" type="uint64" />

        <add name="count_6" type="uint64"/>
        <add name="id" type="Pointer" template="ZString"/>
    </compound>

    <compound name="Transition" inherit="MemStruct">
        40 bytes
        only used if transition is in 'id'
        <add name="count_0" type="uint"/>
        <add name="count_1" type="uint"/>

        <add name="ptr 0" type="Pointer" />

        <add name="count_2" type="uint64"/>

        <add name="ptr 1" type="Pointer" />
        <add name="id" type="Pointer" template="ZString"/>
    </compound>

    <compound name="XMLArray" inherit="MemStruct" >
        <add name="xmls" type="XMLEntry" arr1="#ARG#" />
    </compound>

    <compound name="XMLEntry" inherit="MemStruct">
        8 bytes
        <add name="xml_string" type="Pointer" template="ZString"/>
    </compound>

    <compound name="AnimationActivityData" inherit="MemStruct">
        96 bytes
        <add name="mani" type="Pointer" template="ZString"/>

        <add name="AnimationFlags" type="uint"/>
        <add name="Priorities" type="uint"/>
        <add name="Weight" type="FloatInputData"/>
        <add name="Speed" type="FloatInputData"/>
        <add name="StartingPropThrough" type="float"/>
        <add name="LeadOutTime" type="float"/>
        <add name="SyncPropThroughVariable" type="Pointer" template="ZString"/>

        <add name="count_6" type="uint64"/>
        <add name="OutputPropThroughVariable" type="Pointer" template="ZString"/>

        <add name="AdditionalDataStreams" type="DataStreamResourceDataList"/>
    </compound>

    <compound name="FootPlantActivityData" inherit="MemStruct">
        48 bytes
        <add name="Weight" type="FloatInputData"/>
        <add name="RotationNoIKWeight" type="FloatInputData"/>
        <add name="StickyFeetWeight" type="FloatInputData"/>
    </compound>



    <enum name="TimeLimitMode" numbytes="4" storage="uint" default="0">
		<option value="0" name="Wrap" />
		<option value="1" name="Clamp" />
    </enum>

    <enum name="SubCurveType" numbytes="2" storage="ushort" default="0">
		<option value="0" name="Constant" />
		<option value="1" name="Linear" />
		<option value="2" name="Polynomial" />
		<option value="3" name="Exponential" />
		<option value="4" name="SCurve" />
		<option value="5" name="Bezier" />
    </enum>

    <enum name="SelectActivityActivityMode" numbytes="4" storage="uint" default="0">
		<option value="0" name="AdvanceChildrenTogether" />
		<option value="1" name="RestartChildrenOnSelection" />
		<option value="2" name="ChooseOnceAtStart" />
    </enum>

    <compound name="DataStreamProducerActivityData" inherit="MemStruct">
        72 bytes
        <add name="CurveType" type="uint64"/>
        <add name="DS Name" type="Pointer" template="ZString"/>
        <add name="Type" type="Pointer" template="ZString"/>
        <add name="BoneID" type="Pointer" template="ZString"/>
        <add name="Location" type="Pointer" template="ZString"/>
        <add name="Curve" type="CurveData" />
        <add name="TimeLimitMode" type="TimeLimitMode"/>
        <add name="DataStreamProducerFlags" type="uint"/>
        <add name="PropThroughVariable" type="Pointer" template="ZString"/>
    </compound>

    <compound name="ActivitiesLinks" inherit="MemStruct">
        <add name="activities" type="ActivitiesLink" arr1="#ARG#" />
    </compound>

    <compound name="ActivitiesLink" inherit="MemStruct">
        <add name="linked" type="Pointer" />
    </compound>

    <compound name="SelectActivityActivityData" inherit="MemStruct">
        32 bytes
        <add name="EnumVariable" type="Pointer" template="ZString"/>
        # points to an activity in the main activities array
        <add name="Activities" type="Pointer" template="ActivitiesLinks" arg="num_activities"/>
        <add name="num_activities" type="uint64"/>
        # todo - the following two may be mixed up in the xml spec!!
        <add name="BlendTime" type="float"/>
        <add name="Mode" type="SelectActivityActivityMode"/>
    </compound>

    <compound name="RandomActivityActivityInfoData" inherit="MemStruct">
         bytes
        <add name="EnumVariable" type="Pointer" template="ZString"/>
        <add name="Activities" type="Pointer" />
        <add name="Activities count" type="uint64"/>
        <add name="BlendTime" type="float"/>
        <add name="Mode" type="SelectActivityActivityMode"/>


<!--        								<array def="RandomActivityActivityInfo" name="Activities" type="struct" />-->
<!--								<count32 name="Activities" />-->
<!--								<float name="BlendInTime" />-->
<!--								<float name="BlendOutTime" />-->
<!--								<uint8 max="1" min="0" name="AllowRestartingActivity">0</uint8>-->
<!--								<float name="BlockActivityRestartTime">0.0</float>-->
<!--								<flags32 def="RandomActivityAnimationFlags" name="Flags" />-->
<!--								<uint8 max="1" min="0" name="AlwaysActive">0</uint8>-->
<!--								<float name="MinGap">7.0</float>-->
<!--								<float name="MaxGap">10.0</float>-->
<!--								<ascii name="RandomNumberVar" />-->
<!--        <add name="CurveType" type="uint64"/>-->
<!--        <add name="DS Name" type="Pointer" template="ZString"/>-->
<!--        <add name="Type" type="Pointer" template="ZString"/>-->
<!--        <add name="BoneID" type="Pointer" template="ZString"/>-->
<!--        <add name="Location" type="Pointer" template="ZString"/>-->
<!--        <add name="Curve" type="CurveData" />-->
<!--        <add name="TimeLimitMode" type="TimeLimitMode"/>-->

<!--        <add name="AlwaysActive" type="ushort"/>-->
<!--        <add name="MinGap" type="float"/>-->
<!--        <add name="MaxGap" type="float"/>-->
<!--        <add name="RandomNumberVar" type="Pointer" template="ZString"/>-->
    </compound>

    <compound name="MGTwo" inherit="MemStruct">
        16 bytes
        <add name="count_0" type="uint64"/>
        <add name="ptr" type="Pointer" />
    </compound>

    <compound name="DataStreamResourceDataList" inherit="MemStruct">
        16 bytes
        <add name="count" type="uint64"/>
        <add name="DataStreamResourceData" type="Pointer" template="DataStreamResourceDataPoints" arg="count"/>
    </compound>

    <compound name="DataStreamResourceDataPoints" inherit="MemStruct">
        array
        <add name="data" type="DataStreamResourceData" arr1="#ARG#" />
    </compound>

    <compound name="DataStreamResourceData" inherit="MemStruct">
        56 bytes
        <add name="CurveType" type="uint64"/>
        <add name="DS Name" type="Pointer" template="ZString"/>
        <add name="Type" type="Pointer" template="ZString"/>
        <add name="BoneID" type="Pointer" template="ZString"/>
        <add name="Location" type="Pointer" template="ZString"/>
        <add name="Curve" type="CurveData" />
<!--        <add name="Comment" type="Pointer" template="ZString"/>-->
    </compound>

    <compound name="CurveData" inherit="MemStruct">
        16 bytes
        <add name="count" type="uint64"/>
        <add name="Points" type="Pointer" template="CurveDataPoints" arg="count" />
    </compound>

    <compound name="CurveDataPoints" inherit="MemStruct">
        array
        <add name="data" type="CurveDataPoint" arr1="#ARG#" />
    </compound>

    <compound name="CurveDataPoint" inherit="MemStruct">
        12 bytes
        <add name="x" type="float"/>
        <add name="y" type="short"/>
        <add name="SubCurveType" type="SubCurveType"/>
        <add name="SubsequentCurveParam" type="short"/>
        <add name="SubsequentCurveParamB" type="short"/>
<!--        <add name="Comment" type="Pointer" template="ZString"/>-->
    </compound>

    <compound name="FloatInputData" inherit="MemStruct">
        16 bytes
        <add name="float" type="float"/>
        <add name="OptionalVarAndCurve count" type="uint" />
        <add name="OptionalVarAndCurve" type="uint64" />
    </compound>

    <compound name="TwoPtrFirst" inherit="MemStruct">
        16 bytes
        <add name="ptr" type="Pointer" />
        <add name="count_0" type="uint64"/>
    </compound>

    <compound name="ThirdFrag" inherit="MemStruct">
        72 bytes
        <add name="LuaMethod" type="Pointer" template="ZString"/>

        <add name="count_0" type="uint64"/>
        <add name="count_1" type="uint64"/>

        <add name="ptr_1" type="Pointer" template="TwoPtrFirst"/>

        <add name="count_2" type="uint64"/>
        <add name="count_3" type="uint64"/>

        <add name="ptr_2" type="Pointer" template="Sixtyfour"/>

        <add name="count_4" type="uint64"/>
        <add name="member" type="Pointer" template="ZString"/>
    </compound>

    <compound name="Sixtyfour" inherit="MemStruct">
        64 bytes
        <add name="count_0" type="uint64"/>

        <add name="ptr_0" type="Pointer"/>
        <add name="ptr_1" type="Pointer"/>

        <add name="count_1" type="uint64"/>
        <add name="count_2" type="uint64"/>

        <add name="ptr_2" type="Pointer"/>
        <add name="ptr_3" type="Pointer"/>

        <add name="count_3" type="uint64"/>
    </compound>

</niftoolsxml>
